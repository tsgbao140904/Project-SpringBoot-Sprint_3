<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Duy·ªát c√¥ng th·ª©c</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f5f7fb;
            font-family: system-ui, sans-serif;
        }
        .detail-card {
            background: white;
            padding: 25px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
    </style>
</head>

<body class="p-4">

<a href="/admin/community" class="btn btn-secondary mb-3">
    ‚Üê Quay l·∫°i danh s√°ch
</a>

<div class="container">
    <div class="detail-card">

        <h3 class="fw-bold mb-3" th:text="${recipe.title}"></h3>

        <img th:src="${recipe.imageUrl}"
             class="img-fluid rounded mb-3"
             style="max-height:300px; object-fit:cover; width: 100%;">

        <p><strong>Ng∆∞·ªùi t·∫°o (user_id):</strong> <span th:text="${recipe.userId}"></span></p>
        <p><strong>Ng√†y g·ª≠i:</strong> <span th:text="${recipe.createdAt}"></span></p>

        <hr>

        <h5 class="fw-bold">Nguy√™n li·ªáu</h5>
        <p th:text="${recipe.ingredients}"></p>

        <h5 class="fw-bold">H∆∞·ªõng d·∫´n</h5>
        <p th:text="${recipe.instructions}"></p>

        <hr>

        <!-- FORM UPDATE STATUS -->
        <form th:action="@{'/admin/community/' + ${recipe.id} + '/update'}"
              method="post">

            <label class="mt-3 fw-bold">Tr·∫°ng th√°i duy·ªát</label>
            <select id="statusSelect" name="status" class="form-select">
                <option value="PENDING"
                        th:selected="${recipe.shareStatus == 'PENDING'}">
                    ‚è≥ Ch·ªù duy·ªát
                </option>

                <option value="APPROVED"
                        th:selected="${recipe.shareStatus == 'APPROVED'}">
                    ‚úî ƒê√£ duy·ªát
                </option>

                <option value="REJECTED"
                        th:selected="${recipe.shareStatus == 'REJECTED'}">
                    ‚ùå T·ª´ ch·ªëi
                </option>
            </select>

            <!-- L√Ω do t·ª´ ch·ªëi -->
            <div id="reasonBox" class="mt-3" style="display:none;">
                <label class="fw-bold">L√Ω do t·ª´ ch·ªëi</label>
                <textarea class="form-control"
                          name="reason"
                          rows="3"
                          placeholder="Nh·∫≠p l√Ω do..."
                          th:text="${recipe.shareRejectedReason}">
                </textarea>
            </div>

            <button class="btn btn-primary mt-3">
                üíæ L∆∞u thay ƒë·ªïi
            </button>
        </form>

    </div>
</div>

<!-- TOAST -->
<div class="toast-container">
    <div th:if="${saved}"
         class="toast align-items-center text-bg-success border-0 show">
        <div class="d-flex">
            <div class="toast-body">
                ‚úî C·∫≠p nh·∫≠t th√†nh c√¥ng!
            </div>
        </div>
    </div>
</div>

<script>
    // Hi·ªÉn th·ªã √¥ l√Ω do n·∫øu ch·ªçn "REJECTED"
    const statusSelect = document.getElementById("statusSelect");
    const reasonBox = document.getElementById("reasonBox");

    function toggleReasonBox() {
        reasonBox.style.display = statusSelect.value === "REJECTED" ? "block" : "none";
    }

    toggleReasonBox();
    statusSelect.addEventListener("change", toggleReasonBox);

    // T·ª± ·∫©n toast sau 2 gi√¢y
    setTimeout(() => {
        const toastEl = document.querySelector('.toast');
        if (toastEl) toastEl.classList.remove('show');
    }, 2000);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
