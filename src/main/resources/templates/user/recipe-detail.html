<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt c√¥ng th·ª©c</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background: #f5f5f7; font-family: system-ui, sans-serif; }

    .detail-card {
      border-radius: 18px;
      background: white;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .detail-img {
      height: 320px;
      width: 100%;
      object-fit: cover;
    }

    .category-pill {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 6px 14px;
      border-radius: 999px;
      color: white;
      font-size: 13px;
      font-weight: 600;
    }

    /* ‚úÖ quan tr·ªçng: gi·ªØ xu·ªëng d√≤ng trong text */
    .preline {
      white-space: pre-line; /* hi·ªÉn th·ªã \n, \r\n th√†nh xu·ªëng d√≤ng */
      line-height: 1.6;
      margin-bottom: 0;
    }
  </style>
</head>

<body class="p-3">

<!-- üîô N√öT QUAY L·∫†I -->
<a href="#"
   class="btn btn-secondary mb-3"
   onclick="if (window.history.length > 1) { window.history.back(); } else { window.location.href='/app/home'; } return false;">
  ‚Üê Quay l·∫°i
</a>


<div class="container">
  <div class="detail-card">

    <div class="position-relative">
      <img th:src="${recipe.imageUrl} ?: 'https://via.placeholder.com/900x500'"
           class="detail-img" alt="recipe">

      <span class="category-pill"
            th:style="'background:' + ${(recipe.userCategory != null and recipe.userCategory.colorCode != null) ? recipe.userCategory.colorCode : '#4caf50'}">
          <span th:text="${(recipe.userCategory != null and recipe.userCategory.icon != null) ? recipe.userCategory.icon : 'üçΩÔ∏è'}"></span>
          <span th:text="${(recipe.userCategory != null and recipe.userCategory.name != null) ? recipe.userCategory.name : 'Ch∆∞a ph√¢n lo·∫°i'}"></span>
      </span>
    </div>

    <div class="p-4">

      <h2 class="fw-bold mb-2" th:text="${recipe.title}"></h2>

      <div th:if="${recipe.shareStatus != null}" class="mt-2">
        <div th:if="${recipe.shareStatus == 'PENDING'}" class="alert alert-warning">
          ‚è≥ C√¥ng th·ª©c n√†y ƒëang ch·ªù admin duy·ªát.
        </div>

        <div th:if="${recipe.shareStatus == 'APPROVED'}" class="alert alert-success">
          ‚úî C√¥ng th·ª©c ƒë√£ ƒë∆∞·ª£c admin duy·ªát!
        </div>

        <div th:if="${recipe.shareStatus == 'REJECTED'}" class="alert alert-danger">
          ‚ùå C√¥ng th·ª©c b·ªã t·ª´ ch·ªëi.
          <br>
          <small th:text="'L√Ω do: ' + ${recipe.shareRejectedReason}"></small>
        </div>
      </div>

      <div class="mb-2">
        <strong>Calories:</strong>
        <span th:text="${recipe.calories}"></span> calo
      </div>

      <div class="mb-3">
        <strong>Th·ªùi gian:</strong>
        <span th:text="${recipe.cookingTime}"></span> ph√∫t
      </div>

      <hr>

      <h5>Nguy√™n li·ªáu</h5>
      <p class="preline"
         th:if="${recipe.ingredients != null and !#strings.isEmpty(recipe.ingredients)}"
         th:text="${recipe.ingredients}"></p>

      <p class="text-muted"
         th:if="${recipe.ingredients == null or #strings.isEmpty(recipe.ingredients)}">
        Ch∆∞a c√≥ nguy√™n li·ªáu.
      </p>

      <h5 class="mt-3">H∆∞·ªõng d·∫´n</h5>
      <p class="preline"
         th:if="${recipe.instructions != null and !#strings.isEmpty(recipe.instructions)}"
         th:text="${recipe.instructions}"></p>

      <p class="text-muted"
         th:if="${recipe.instructions == null or #strings.isEmpty(recipe.instructions)}">
        Ch∆∞a c√≥ h∆∞·ªõng d·∫´n.
      </p>

      <hr>

      <!-- üî• CH·ªà CH·ª¶ C√îNG TH·ª®C TH·∫§Y N√öT -->
      <div th:if="${isOwner != null and isOwner}" class="mt-3">

        <a th:href="@{'/app/recipes/' + ${recipe.id} + '/edit'}"
           class="btn btn-warning"
           th:if="${recipe.shareStatus != 'APPROVED'}">
          ‚úè S·ª≠a
        </a>

        <button class="btn btn-secondary"
                th:if="${recipe.shareStatus == 'APPROVED'}"
                disabled>
          ‚úè ƒê√£ duy·ªát ‚Äì Kh√¥ng th·ªÉ s·ª≠a
        </button>

        <form th:action="@{'/app/recipes/' + ${recipe.id} + '/delete'}"
              method="post" style="display:inline">
          <button class="btn btn-danger">üóë X√≥a</button>
        </form>

        <form th:if="${recipe.shareStatus == null or recipe.shareStatus == 'REJECTED'}"
              th:action="@{'/app/recipes/' + ${recipe.id} + '/share'}"
              method="post"
              style="display:inline">
          <button class="btn btn-info"
                  onclick="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën chia s·∫ª c√¥ng th·ª©c n√†y ch·ª©?')">
            üîó Chia s·∫ª
          </button>
        </form>

        <button th:if="${recipe.shareStatus == 'PENDING'}"
                class="btn btn-secondary"
                disabled>
          ‚è≥ Ch·ªù duy·ªát
        </button>

        <button th:if="${recipe.shareStatus == 'APPROVED'}"
                class="btn btn-success"
                disabled>
          ‚úî ƒê√£ duy·ªát
        </button>

      </div>

    </div>
  </div>
</div>

</body>
</html>
